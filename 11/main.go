package main

import (
	"fmt"
	"math"
	"slices"
	"strings"
)

const input = `
...#...................#.......................#.......................................................#....................................
........................................................#...................................................................................
...............................#..........#..........................#.....#......................#.........................................
......#.................................................................................#.............................#..............#......
...........................................................................................................................................#
.................#........#.........................#...........#................#....................#......#..............................
........................................#................#....................................#..............................#..............
......................#.....................................................................................................................
..#.........#.......................#..............................#...............................................................#........
.............................................................#..................................................#...........................
...................#...........#...................#....................#...............................................#...................
...........................................#...................................#.....................#......#...............................
....#.........................................................................................................................#.............
........................................................................................#..........................#........................
...........#........................#..........................#............#...............................................................
.#...........................#..............................................................................................................
...............#..........................#................#.......................#.......................#................................
.....................#...........................................................................................#..........................
.........#.......................................#..................#..........#............#..........#..................#.................
.......................................................................................................................................#....
....................................#........................#..........................#...................................................
.....#.....................................#................................................................................................
...............#......................................#......................................................#....................#.........
....................#................................................................#.......#...............................#..............
...........#................................................................................................................................
.........................#......................#...........................................................................................
...#..............................#....................................#...........................#........................................
..................................................................#..................................................................#......
..........................................#..........#......................#............................................#..................
...............#......................................................................#..........................#........................#.
.....................#......................................................................................................................
..................................................#.............#.................................#.........................................
#..........................#.........................................................................................#......................
.....................................#......#................................#..............#...............#..................#............
........#............................................................................................#................................#.....
................................................................................................................#...........................
...............................#.......................#..................#................................................#................
..................................................................................................#...................#....................#
............................................................................................................................................
................#..........#....................#..................#..........................................#.............................
........#.................................#........................................#.....#.....................................#............
.......................#............................................................................................#.......................
.........................................................................................................................#.........#........
........................................................................................................#...................................
....#.......#...............#........................................#......................................................................
...........................................#.....#.............................................................#..............#.........#...
............................................................................................................................................
.....................#................#..................#....................#..............#..............................................
......#.....................................................................................................................................
...............#......................................................................................#.........................#...........
........................#...........................#..........#......................................................#.....................
.........................................#...........................#.................#......................#.............................
............................................................................................................................................
............................#.............................#.................................#..............................#...........#....
.#...........#......................#.........#...........................#.................................................................
............................................................................................................................................
.................#..................................................................#...........#.........#......................#..........
............................................................................................................................................
............................................................................................................................................
.........#...................#.................................#.............#..............................................................
...............#....................................................#...............................................#.....#.................
..........................................#..............................................#...........#.......#..............................
..#..................................................................................................................................#......
..........................................................................#.........#.......................................................
....................................#.........................#.........................................................#...................
...............................#................................................................#...........................................
...........#.............................................#............................................#............#........................
...........................................................................................................................#............#...
................#...........................#......................#..........#.......#.....................................................
#......................................................................................................................#............#.......
........................................................................#..................................#................................
..............................................................#...........................#.....#.........................................#.
......#.......#.....#.............#.........................................................................................................
.............................#.........#..................#.................................................................................
..........#.........................................................................................................#.......................
......................................................#................................................#...................#................
....#....................#.........................................#.........................................#..............................
....................................#.........#...............#...............#..............#...................................#..........
............................................................................................................................................
.............................#..................................................................................#.......#...................
........................................#................#...............#..................................................................
............................................................................................................................................
.............................................................#.........................#................#...................................
..........#......#............................#..................................#...............#..............................#.........#.
..................................#.................................................................................#.......................
....................................................#.......................#...............#.................#.......................#.....
.#...........#........................#..............................................#......................................................
................................................................#.......#..............................#....................................
..................................................................................................#...........................#.............
............................................................#............................................................#..............#...
......#.....................#......................................#...........#............................................................
.....................................................#.............................................................#.............#..........
.......................#.............#.....................................................................................................#
...........#.................................#............................#...........................#.....................................
.#...............................#....................................................................................#.....................
...................#...................................#..........................................#..............#..........................
.........................#.......................................#.............#............................................................
..........................................#.......#.....................#................#..................................#...............
...#.......................................................................................................#............................#...
............#.............................................#..................................#...................................#..........
............................#..........#.............................................................#.............#........................
......................#.....................................................................................................................
.............................................................................................................#..............................
....#........................................#.....................................#.......................................#................
.....................................................#..............#...................................................................#...
#....................................#....................#.......................................................................#.........
................................................................................................#...........................................
...........#.........#....................#...............................#.............#................................#..................
............................................................................................................................................
......#..........................#...........................#...........................................#...........#......................
.#.............#.........#.........................................#...........#.....#..................................................#...
.....................................#...................#.....................................................................#............
...........................................................................................#................................................
...................#................................................................................#..............#........................
...........................................#......#........................................................................................#
..#........................#..................................#.........................#...................................................
........#.............................#...............................................................................#.....................
...............................#........................#...............#..............................#....................................
.................................................................#..........................................#...............................
....................................................#........................#........#....................................#.........#......
....#.........#....................................................................................#.......................................#
......................#.....#.............................................................#.................................................
#......................................#......#....................................#...............................#.............#..........
.......................................................#..................................................#.................................
.........................................................................#......................#...........................................
...............................................................................#............................................#...............
....#........#................#...............................#.......................................................................#.....
.......................#.................................................................#..................#...............................
.....................................#.............#........................................................................................
...................................................................................................#......................................#.
..#.........................................................................................................................................
........#.................................#.............#...........#................#......................................................
...............................................................................................#............................#...............
.................#....................#.........................#..................................................................#........
....#.............................................#........................................................#........#.......................
.........................#.............................................#............................#.......................................
......................................................#.................................#................................................#..
.............................#...............#.................................#............................................................
.........#....................................................................................#........................#........#...........
..................#...........................................#.................................................#...........................
`

func getGals(matrix [][]rune) [][2]int {
	gals := [][2]int{}
	counter := 1
	for y := 0; y < len(matrix); y++ {
		for x := 0; x < len(matrix[0]); x++ {
			if matrix[y][x] == '#' {
				matrix[y][x] = rune(counter)
				gals = append(gals, [2]int{x, y})
				counter++
			} else {
				matrix[y][x] = 0
			}
		}
	}
	return gals
}

func main() {
	matrix := parseMatrix(input)
	gals := getGals(matrix)

	mul := 1000000
	gals = expand(gals, 0, mul)
	gals = expand(gals, 1, mul)
	fmt.Println(gals)

	distances := 0
	pairs := map[[4]int]struct{}{}
	for _, g1 := range gals {
		for _, g2 := range gals {
			if g1[0] == g2[0] && g1[1] == g2[1] {
				continue
			}
			_, ok := pairs[[4]int{g2[0], g2[1], g1[0], g1[1]}]
			if ok {
				continue
			}
			pairs[[4]int{g1[0], g1[1], g2[0], g2[1]}] = struct{}{}

			d := distance(g1[0], g1[1], g2[0], g2[1])
			distances += d
		}
	}
	fmt.Println(distances)
}

func expand(gals [][2]int, axis int, multiplier int) [][2]int {
	slices.SortFunc(gals, func(a [2]int, b [2]int) int {
		return a[axis] - b[axis]
	})

	ysMap := map[int]struct{}{}
	for i := 1; i < len(gals); i++ {
		_, ok := ysMap[gals[i][axis]]
		if ok {
			continue
		}
		ysMap[gals[i][axis]] = struct{}{}
		gap := gals[i][axis] - gals[i-1][axis] - 1
		if gap <= 0 {
			continue
		}
		if i == len(gals) {
			continue
		}
		fmt.Println("increasing", gap, gals[i-1], gals[i])
		for j := range gals[i:] {
			gals[j+i][axis] += (multiplier - 1) * gap
		}
	}
	return gals
}

func cp(matrix [][]rune) [][]rune {
	temp := make([][]rune, len(matrix))
	for y := 0; y < len(matrix); y++ {
		temp[y] = make([]rune, len(matrix[y]))
		for x := 0; x < len(matrix[0]); x++ {
			temp[y][x] = matrix[y][x]
		}
	}
	return temp
}

func rotate(matrix [][]rune) [][]rune {
	temp := make([][]rune, len(matrix[0]))
	for y := 0; y < len(matrix); y++ {
		for x := 0; x < len(matrix[0]); x++ {
			temp[x] = append(temp[x], matrix[y][x])
		}
	}
	return temp
}

func distance(x1, y1, x2, y2 int) int {
	return int(math.Abs(float64(x2)-float64(x1)) + math.Abs(float64(y2)-float64(y1)))
}

func parseMatrix(input string) [][]rune {
	lines := strings.Split(input[1:len(input)-1], "\n")

	matrix := [][]rune{}
	for _, l := range lines {
		matrix = append(matrix, []rune(l))
	}

	return matrix
}
